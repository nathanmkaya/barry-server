# **Barry Server \- Project Structure**

This document outlines the directory and file structure of the `barry-server` project.

```
barry-server/  
├── cmd/server/                 \# Main application entry point  
│   └── main.go                 \# \- Initializes config, services, gRPC server.  
│                               \# \- Handles graceful shutdown.  
│                               \# \- Wires dependencies together.  
│  
├── internal/                   \# Internal application code (not importable by other Go projects)  
│   ├── config/                 \# Configuration loading logic  
│   │   └── config.go           \#   \- Defines Config struct.  
│   │                           \#   \- Loads config from environment variables.  
│   │  
│   ├── grpc/                   \# gRPC Service Implementation Layer  
│   │   └── speedtest\_service.go \#   \- Implements the \`SpeedTestServiceServer\` interface generated by protoc.  
│   │                           \#   \- Handles gRPC request/response mapping, stream lifecycle.  
│   │                           \#   \- Delegates business logic to injected service interfaces.  
│   │                           \#   \- Translates service errors to gRPC status codes.  
│   │  
│   ├── service/                \# Business Logic / Service Layer  
│   │   ├── interfaces.go       \#   \- Defines interfaces for core functionalities (ServerProvider, DownloadStreamer, etc.).  
│   │   ├── server\_provider.go  \#   \- Implementation for providing server lists (simple version returns self).  
│   │   ├── download\_streamer.go\#   \- Implementation for generating and streaming download data.  
│   │   ├── upload\_handler.go   \#   \- Implementation for handling and processing upload streams.  
│   │   └── ip\_detector.go      \#   \- Implementation for detecting client IP (from peer/headers).  
│   │  
│   └── utils/                  \# Shared utility functions  
│       └── datagen.go          \#   \- Helpers for generating test data (e.g., ConstantReader).  
│  
├── proto/speedtest/            \# Generated Go code from .proto files (DO NOT EDIT MANUALLY)  
│   ├── speedtest.pb.go         \#   \- Generated Go structs for Protobuf messages.  
│   └── speedtest\_grpc.pb.go    \#   \- Generated gRPC client stubs and server interfaces.  
│  
├── api/proto/                  \# Source Protobuf definition file(s)  
│   └── speedtest.proto         \#   \- Defines the gRPC services, methods, and message types.  
│                               \#   \- The single source of truth for the API contract.  
│  
├── go.mod                      \# Go module definition file (defines module path, dependencies).  
├── go.sum                      \# Dependency checksums.  
├── Dockerfile                  \# Defines how to build the Docker container image.  
└── README.md                   \# Main project documentation (this file).

```

## **Layers Explained**

1. **`cmd` Layer:** The entry point of the application. Responsible for initialization, dependency wiring (instantiating services and handlers), starting the server, and handling shutdown signals.  
2. **`internal/grpc` Layer:** The gRPC transport layer. It adapts incoming gRPC requests to calls on the business logic services and translates results/errors back into gRPC responses/statuses. It depends on service interfaces.  
3. **`internal/service` Layer:** Contains the core business logic, decoupled from the transport layer (gRPC). Services implement specific functionalities defined by interfaces. They depend on configuration, utilities, and potentially repository/infrastructure interfaces (if DB/Cache were added).  
4. **`internal/config` & `internal/utils` Layers:** Provide cross-cutting concerns like configuration loading and reusable utility functions.  
5. **`proto` & `api/proto`:** Define the API contract using Protobuf and contain the auto-generated code for interacting with that contract.

This structure promotes separation of concerns, making the application easier to understand, test, and maintain.